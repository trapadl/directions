<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>trap. directions</title>
  <style>
    body {
      margin: 0;
      background: #f9f6f6;
      color: #050505;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }

    img.logo {
      width: 100px;
      margin-bottom: 1rem;
    }

    .step {
      max-width: 90%;
      margin-bottom: 2rem;
    }

    .step h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem;
    }

    .step p {
      font-size: 1rem;
      margin: 0.25rem 0;
    }

    .cta {
      font-weight: 700;
      margin-top: 1rem;
      text-decoration: underline;
      cursor: pointer;
    }

    .countdown {
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <img src="logo.png" alt="trap. logo" class="logo" />
  <div id="content"></div>

  <script>
    const openingHours = [
      { day: 3, open: 18, close: 24 }, // Wednesday
      { day: 4, open: 18, close: 24 }, // Thursday
      { day: 5, open: 16, close: 26 }, // Friday (26 = 2am Saturday)
      { day: 6, open: 16, close: 26 }  // Saturday
    ];

    function isBarOpen(now) {
      const day = now.getDay();
      const hour = now.getHours();
      const minute = now.getMinutes();
      const decimalTime = hour + minute / 60;

      for (const slot of openingHours) {
        const closeDay = slot.close > 24 ? (slot.day + 1) % 7 : slot.day;
        const closeTime = slot.close > 24 ? slot.close - 24 : slot.close;

        if (slot.day === day && decimalTime >= slot.open) return true;
        if (closeDay === day && decimalTime < closeTime) return true;
      }

      return false;
    }

    function getNextOpening(now) {
      for (let i = 0; i < 7; i++) {
        const testDate = new Date(now);
        testDate.setDate(now.getDate() + i);
        const day = (now.getDay() + i) % 7;

        const slot = openingHours.find(h => h.day === day);
        if (slot) {
          const openTime = new Date(testDate);
          openTime.setHours(slot.open >= 24 ? slot.open - 24 : slot.open);
          openTime.setMinutes(0, 0, 0);
          if (slot.open >= 24) openTime.setDate(openTime.getDate() + 1);
          if (openTime > now) return openTime;
        }
      }
      return null;
    }

    function updateContent() {
      const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Australia/Adelaide" }));
      const container = document.getElementById('content');

      if (isBarOpen(now)) {
        container.innerHTML = `
          <div class="step">
            <h2><img src="logo.png" class="logo" /> is open.</h2>
            <p>1. Walk west on Currie St to the corner of Burnett St (Sofitel Hotel).</p>
            <div class="cta" onclick="nextStep(2)">next step →</div>
          </div>
        `;
      } else {
        const next = getNextOpening(now);
        if (!next) return container.innerHTML = "<p>Unable to determine next opening time.</p>";

        const diff = Math.floor((next - now) / 1000);
        const hours = Math.floor(diff / 3600);
        const minutes = Math.floor((diff % 3600) / 60);
        const seconds = diff % 60;

        container.innerHTML = `
          <div class="countdown">
            <img src="logo.png" class="logo" /><br/>
            opens in ${hours}h ${minutes}m ${seconds}s
          </div>
        `;
      }
    }

    function nextStep(step) {
      const container = document.getElementById('content');
      if (step === 2) {
        container.innerHTML = `
          <div class="step">
            <h2>Step 2</h2>
            <p>Turn right onto Burnett St and walk down to first laneway on your right.</p>
            <div class="cta" onclick="nextStep(3)">next step →</div>
          </div>
        `;
      } else if (step === 3) {
        container.innerHTML = `
          <div class="step">
            <h2>Final Step</h2>
            <p>Turn onto Cold Chisel Lane and down to <img src="logo.png" class="logo" /></p>
          </div>
        `;
      }
    }

    updateContent();
    setInterval(updateContent, 1000);
  </script>
</body>
</html>
