<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>trap. — directions</title>

    <!--
      ▸ FONT – Acumin Variable is proprietary. If you have the files, drop them in the same folder
        and keep this @font‑face. Otherwise delete it and rely on the fall‑backs.
    -->
    <style>
      @font-face {
        font-family: "Acumin Variable";
        src: url("AcuminVariableConcept.otf") format("opentype");
        font-weight: 100 900;
        font-display: swap;
      }

      :root {
        --bg: #f9f6f6; /* paper white */
        --fg: #050505; /* almost black */
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        background: var(--bg);
        color: var(--fg);
        font-family: "Acumin Variable", "Helvetica Neue", Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden; /* no scrolling */
      }

      /* layout container */
      #wrapper {
        text-align: center;
        max-width: 90vw;
      }

      /* logo placeholder */
      #logo {
        width: 180px;
        height: auto;
        margin: 0 auto 1.5rem;
        display: block;
      }

      h1,
      h2 {
        font-weight: 800; /* bold */
        margin-bottom: 0.4em;
      }

      p {
        font-size: 1.2rem;
        font-weight: 400; /* regular */
      }

      button {
        margin-top: 1.4rem;
        padding: 0.8rem 1.8rem;
        border: none;
        background: var(--fg);
        color: var(--bg);
        font-family: inherit;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
      }

      button:active {
        transform: scale(0.97);
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>

  <body>
    <div id="wrapper">
      <img id="logo" src="logo.png" alt="trap. logo" />
      <h1 id="headline"></h1>
      <p id="sub"></p>
      <button id="cta" class="hidden"></button>
    </div>

    <script>
      // ————————————————
      //  SCHEDULE (Adelaide time)
      //  dow: 0=Sun … 6=Sat
      //  Use "24" & "26" hrs to indicate close after midnight
      // ————————————————
      const SCHEDULE = [
        { dow: 3, start: "18:00", end: "24:00" }, // Wed 18‑24
        { dow: 4, start: "18:00", end: "24:00" }, // Thu 18‑24
        { dow: 5, start: "16:00", end: "26:00" }, // Fri 16‑02
        { dow: 6, start: "16:00", end: "26:00" }, // Sat 16‑02
      ];

      const TZ = "Australia/Adelaide";

      /*–––– date helpers ––––*/
      function toLocal(dateUTC) {
        // Convert a UTC date → local Date object in the desired TZ (hacky but works cross‑browser)
        const parts = new Intl.DateTimeFormat("en-CA", {
          timeZone: TZ,
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: false,
        })
          .formatToParts(dateUTC)
          .reduce((acc, p) => ((acc[p.type] = p.value), acc), {});
        return new Date(
          `${parts.year}-${parts.month}-${parts.day}T${parts.hour}:${parts.minute}:${parts.second}`
        );
      }

      function parseTime(base, targetDow, timeStr) {
        const [hrRaw, min] = timeStr.split(":" ).map(Number);
        const carry = Math.floor(hrRaw / 24);
        const hour = hrRaw % 24;

        const d = new Date(base);
        const diff = (targetDow - d.getDay() + 7) % 7; // days until the target DOW
        d.setHours(0, 0, 0, 0);
        d.setDate(d.getDate() + diff + carry);
        d.setHours(hour, min, 0, 0);
        return d;
      }

      function getStatus(now) {
        // Is open?
        for (const entry of SCHEDULE) {
          const open = parseTime(now, entry.dow, entry.start);
          const close = parseTime(now, entry.dow, entry.end);
          if (now >= open && now < close) {
            return { open: true };
          }
        }
        // Otherwise find next opening
        let soonest = null;
        for (const entry of SCHEDULE) {
          let open = parseTime(now, entry.dow, entry.start);
          if (open < now) open.setDate(open.getDate() + 7); // next week
          if (!soonest || open < soonest) soonest = open;
        }
        return { open: false, next: soonest };
      }

      /*–––– UI ––––*/
      const headline = document.getElementById("headline");
      const sub = document.getElementById("sub");
      const cta = document.getElementById("cta");

      const steps = [
        {
          title: "trap. is open.",
          body:
            "Walk west on Currie St to the corner of Burnett St (Sofitel Hotel).",
          cta: "Got it",
        },
        {
          title: "",
          body:
            "Turn right onto Burnett St and walk down to the first laneway on your right.",
          cta: "Next",
        },
        {
          title: "",
          body: "Turn onto Cold Chisel Lane and down to trap.",
          cta: null,
        },
      ];

      let stepIndex = 0;
      let inStepMode = false;

      function showStep() {
        const s = steps[stepIndex];
        headline.textContent = s.title;
        sub.textContent = s.body;
        if (s.cta) {
          cta.textContent = s.cta;
          cta.classList.remove("hidden");
        } else {
          cta.classList.add("hidden");
        }
      }

      cta.addEventListener("click", () => {
        if (!inStepMode) return;
        stepIndex = Math.min(stepIndex + 1, steps.length - 1);
        showStep();
      });

      function pad(n) {
        return String(n).padStart(2, "0");
      }

      function render() {
        const now = toLocal(new Date());
        const status = getStatus(now);

        if (status.open) {
          if (!inStepMode) {
            inStepMode = true;
            stepIndex = 0;
            showStep();
          }
        } else {
          inStepMode = false;
          const diffSec = Math.round((status.next - now) / 1000);
          const h = Math.floor(diffSec / 3600);
          const m = Math.floor((diffSec % 3600) / 60);
          const s = diffSec % 60;

          headline.textContent = "trap. opens in";
          sub.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
          cta.classList.add("hidden");
        }
      }

      render();
      setInterval(render, 1000); // keep ticking
    </script>
  </body>
</html>
